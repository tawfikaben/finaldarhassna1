<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>دار حسنا | مطعم مغربي</title>
  <!-- خطوط Google -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <!-- أيقونات Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #E94560; /* زهري غامق */
      --secondary: #0F3460; /* أزرق داكن */
      --light: #F8F5F2; /* كريمي */
      --dark: #16213E; /* أزرق ليلي */
      --gold: #FFD32D; /* ذهبي */
      --text: #2D3748;
      --white: #FFFFFF;
      --gray: #EDF2F7;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
      --radius: 12px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Tajawal', sans-serif;
      background-color: var(--light);
      color: var(--text);
      line-height: 1.6;
    }

    .container {
      width: 100%;
      max-width: 100%;
      padding: 0 1rem;
    }

    /* شريط التنقل للجوال */
    .mobile-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--white);
      display: flex;
      justify-content: space-around;
      padding: 0.8rem 0;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      z-index: 100;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--text);
      text-decoration: none;
      font-size: 0.8rem;
    }

    .nav-item i {
      font-size: 1.2rem;
      margin-bottom: 0.3rem;
    }

    .nav-item.active {
      color: var(--primary);
    }

    /* الهيدر المعدل للجوال */
    .hero {
      padding: 5rem 0 3rem;
      background: linear-gradient(135deg, var(--dark), var(--secondary));
      color: var(--white);
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .hero::before {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      background: url('https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80') no-repeat center/cover;
      opacity: 0.2;
    }

    .logo {
      font-size: 2.2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      position: relative;
      display: inline-block;
    }

    .logo::after {
      content: "";
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: var(--gold);
    }

    .subtitle {
      font-size: 1rem;
      opacity: 0.9;
      margin-bottom: 1.5rem;
      padding: 0 1rem;
    }

    .date-badge {
      display: inline-flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.2);
      color: var(--white);
      padding: 0.5rem 1.2rem;
      border-radius: 50px;
      font-size: 0.9rem;
    }

    .date-badge i {
      margin-left: 0.5rem;
    }

    /* قسم القائمة للجوال */
    .menu-section {
      padding: 2rem 0;
    }

    .section-title {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .section-title h2 {
      font-size: 1.8rem;
      color: var(--dark);
      display: inline-block;
      position: relative;
      padding-bottom: 0.8rem;
    }

    .section-title h2::after {
      content: "";
      position: absolute;
      bottom: 0;
      right: 50%;
      transform: translateX(50%);
      width: 80px;
      height: 3px;
      background: linear-gradient(to right, var(--primary), var(--gold));
    }

    .menu-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .menu-category {
      background: var(--white);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .category-header {
      background: var(--dark);
      color: var(--white);
      padding: 1rem;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
    }

    .category-header i {
      margin-left: 0.5rem;
    }

    .category-items {
      padding: 0.5rem;
    }

    .menu-item {
      display: flex;
      justify-content: space-between;
      padding: 1rem;
      border-bottom: 1px dashed var(--gray);
      transition: var(--transition);
    }

    .menu-item:last-child {
      border-bottom: none;
    }

    .item-info {
      flex: 1;
    }

    .item-name {
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 0.3rem;
      display: flex;
      align-items: center;
    }

    .item-name i {
      margin-left: 0.5rem;
      color: var(--gold);
      font-size: 0.9rem;
    }

    .item-desc {
      font-size: 0.85rem;
      color: var(--text);
      opacity: 0.8;
    }

    .item-price {
      font-weight: 700;
      color: var(--primary);
      min-width: 60px;
      text-align: left;
    }

    /* المسافة تحت الحلويات والمشروبات */
    .after-desserts {
      height: 20px;
    }

    /* شريط السلة العائم المعدل */
    .cart-floating {
      position: fixed;
      bottom: 80px;
      left: 1rem;
      background: var(--primary);
      color: var(--white);
      width: calc(100% - 2rem);
      padding: 1rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 90;
      transform: translateY(150%);
      transition: var(--transition);
    }

    .cart-floating.active {
      transform: translateY(0);
    }

    .cart-info {
      display: flex;
      align-items: center;
    }

    .cart-icon {
      position: relative;
      margin-left: 0.8rem;
    }

    .cart-count {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--gold);
      color: var(--dark);
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 700;
    }

    .cart-total {
      font-weight: 700;
    }

    .view-cart {
      background: var(--white);
      color: var(--primary);
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 50px;
      font-weight: 600;
      font-size: 0.9rem;
    }

    /* نموذج الطلب للجوال */
    .order-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      z-index: 200;
      display: flex;
      flex-direction: column;
      transform: translateY(100%);
      transition: var(--transition);
    }

    .order-modal.active {
      transform: translateY(0);
    }

    .modal-header {
      background: var(--dark);
      color: var(--white);
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .close-modal {
      background: none;
      border: none;
      color: var(--white);
      font-size: 1.5rem;
    }

    .modal-body {
      background: var(--white);
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }

    .order-items {
      margin-bottom: 1rem;
    }

    .order-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8rem;
      background: var(--light);
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }

    .item-actions {
      display: flex;
      align-items: center;
    }

    .action-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--dark);
      color: var(--white);
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 0.5rem;
    }

    .action-btn.remove {
      background: var(--primary);
    }

    .order-total {
      font-weight: 700;
      font-size: 1.2rem;
      text-align: left;
      margin: 1rem 0;
      padding-top: 1rem;
      border-top: 1px dashed var(--gray);
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-control {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid var(--gray);
      border-radius: 8px;
      font-family: 'Tajawal', sans-serif;
    }

    .submit-btn {
      background: linear-gradient(to right, var(--primary), var(--dark));
      color: var(--white);
      border: none;
      padding: 1rem;
      width: 100%;
      border-radius: 8px;
      font-weight: 600;
      margin-top: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .submit-btn i {
      margin-left: 0.5rem;
    }

    /* رسالة التأكيد */
    .confirmation {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: var(--white);
      padding: 2rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      text-align: center;
      z-index: 300;
      transition: var(--transition);
      max-width: 90%;
    }

    .confirmation.active {
      transform: translate(-50%, -50%) scale(1);
    }

    .confirmation i {
      font-size: 2.5rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }

    /* الفوتر المعدل */
    footer {
      background: var(--dark);
      color: var(--white);
      padding: 2rem 1rem;
      text-align: center;
    }

    .footer-info {
      margin-bottom: 1.5rem;
    }

    .footer-logo {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .footer-address {
      margin: 1rem 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .footer-address i {
      margin-left: 0.5rem;
    }

    .social-links {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }

    .social-link {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 0.5rem;
      color: var(--white);
      transition: var(--transition);
    }

    .social-link:hover {
      background: var(--primary);
    }

    .copyright {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.9rem;
      opacity: 0.8;
    }

    /* تأثيرات للشاشات الكبيرة */
    @media (min-width: 768px) {
      .mobile-nav {
        display: none;
      }
      
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 2rem;
      }
      
      .hero {
        padding: 7rem 0 4rem;
      }
      
      .logo {
        font-size: 3rem;
      }
    }
  </style>
</head>
<body>
  <!-- الهيدر -->
  <section class="hero">
    <div class="container">
      <h1 class="logo">دار حسنا</h1>
      <p class="subtitle">مذاق مغربي أصيل في تجربة عصرية</p>
      <div class="date-badge">
        <i class="fas fa-calendar-alt"></i>
        <span id="today-date"></span>
      </div>
    </div>
  </section>

  <!-- القائمة -->
  <section class="menu-section">
    <div class="container">
      <div class="section-title">
        <h2>قائمتنا الشهية</h2>
      </div>

      <div class="menu-list" id="menuContainer">
        <!-- سيتم تعبئة القائمة ديناميكياً هنا -->
        <div class="loading">جاري تحميل القائمة...</div>
      </div>

      <!-- المسافة المطلوبة تحت الحلويات والمشروبات -->
      <div class="after-desserts" id="afterDesserts"></div>
    </div>
  </section>

  <!-- شريط السلة العائم -->
  <div class="cart-floating" id="cartFloating">
    <div class="cart-info">
      <div class="cart-icon">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count" id="cartCount">0</span>
      </div>
      <span>سلة المشتريات</span>
    </div>
    <div class="cart-total" id="cartTotal">0 درهم</div>
    <button class="view-cart" id="viewCart">عرض</button>
  </div>

  <!-- نموذج الطلب (مودال) -->
  <div class="order-modal" id="orderModal">
    <div class="modal-header">
      <h3>تأكيد الطلب</h3>
      <button class="close-modal" id="closeModal">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <form id="commandeForm">
        <div class="form-group">
          <label for="table">رقم الطاولة</label>
          <input type="number" id="table" class="form-control" min="1" required>
        </div>
        
        <div class="form-group">
          <label for="notes">ملاحظات</label>
          <textarea id="notes" class="form-control" rows="3" placeholder="أي ملاحظات أو طلبات خاصة"></textarea>
        </div>
        
        <div class="order-items" id="listeCommandes">
          <div style="text-align: center; padding: 2rem 0; color: var(--text); opacity: 0.6;">
            <i class="fas fa-shopping-cart" style="font-size: 2rem; margin-bottom: 1rem;"></i>
            <p>لا توجد أصناف في السلة</p>
          </div>
        </div>
        
        <div class="order-total" id="totalCommande">المجموع: 0 درهم</div>
        
        <button type="submit" class="submit-btn">
          <i class="fas fa-paper-plane"></i> تأكيد الطلب
        </button>
      </form>
    </div>
  </div>

  <!-- رسالة التأكيد -->
  <div class="confirmation" id="confirmation">
    <i class="fas fa-check-circle"></i>
    <h3 style="margin-bottom: 1rem;">تم تأكيد طلبك بنجاح!</h3>
    <p id="confirmationText"></p>
    <button class="submit-btn" id="closeConfirmation" style="margin-top: 1.5rem;">
      <i class="fas fa-times"></i> إغلاق
    </button>
  </div>

  <!-- الفوتر مع معلومات المطعم -->
  <footer>
    <div class="container">
      <div class="footer-info">
        <div class="footer-logo">دار حسنا</div>
        <p>مطعم مغربي أصيل منذ 1985</p>
        <div class="footer-address">
          <i class="fas fa-map-marker-alt"></i>
          <span>شارع المختار السوسي، بيوگرى
        </div>
      </div>
      
      <div class="social-links">
        <a href="#" class="social-link"><i class="fab fa-facebook-f"></i></a>
        <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
        <a href="#" class="social-link"><i class="fab fa-whatsapp"></i></a>
      </div>
      
      <div class="copyright">
        © 2023 جميع الحقوق محفوظة لدار حسنا
      </div>
    </div>
  </footer>

  <!-- شريط التنقل للجوال -->
  <nav class="mobile-nav">
    <a href="#" class="nav-item active">
      <i class="fas fa-home"></i>
      <span>الرئيسية</span>
    </a>
    <a href="#" class="nav-item">
      <i class="fas fa-utensils"></i>
      <span>القائمة</span>
    </a>
    <a href="#" class="nav-item" id="cartNavItem">
      <i class="fas fa-shopping-cart"></i>
      <span>السلة</span>
    </a>
    <a href="#" class="nav-item">
      <i class="fas fa-info-circle"></i>
      <span>حولنا</span>
    </a>
  </nav>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDpSF4J0bsd6T0ImMpse0KQQRADaxiYUQw",
      authDomain: "darhassna-484c3.firebaseapp.com",
      databaseURL: "https://darhassna-484c3-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "darhassna-484c3",
      storageBucket: "darhassna-484c3.firebasestorage.app",
      messagingSenderId: "141393162149",
      appId: "1:141393162149:web:0717227eac221f5ddfc24c"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // متغيرات لتخزين الطلبات
    let commandes = [];
    let total = 0;
    let cartTimeout;

    // عناصر DOM
    const cartFloating = document.getElementById('cartFloating');
    const cartCount = document.getElementById('cartCount');
    const cartTotal = document.getElementById('cartTotal');
    const viewCartBtn = document.getElementById('viewCart');
    const orderModal = document.getElementById('orderModal');
    const closeModalBtn = document.getElementById('closeModal');
    const cartNavItem = document.getElementById('cartNavItem');
    const confirmation = document.getElementById('confirmation');
    const confirmationText = document.getElementById('confirmationText');
    const closeConfirmationBtn = document.getElementById('closeConfirmation');
    const afterDesserts = document.getElementById('afterDesserts');

    // دالة لعرض تاريخ اليوم بالأرقام الفرنسية
    function displayTodayDate() {
      const today = new Date();
      const day = String(today.getDate()).padStart(2, '0');
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const year = today.getFullYear();
      document.getElementById('today-date').textContent = `${day}/${month}/${year}`;
    }

    // دالة لتحميل وعرض القائمة من Firebase
    function loadAndDisplayMenu() {
      database.ref('menu').on('value', (snapshot) => {
        const menuData = snapshot.val();
        const menuContainer = document.getElementById('menuContainer');
        
        if (menuData && menuData.length > 0) {
          menuContainer.innerHTML = '';
          
          menuData.forEach((section, index) => {
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'menu-category';
            
            const categoryHeader = document.createElement('div');
            categoryHeader.className = 'category-header';
            categoryHeader.innerHTML = `
              <i class="fas fa-${section.icon || 'utensils'}"></i>
              ${section.section}
            `;
            
            const categoryItems = document.createElement('div');
            categoryItems.className = 'category-items';
            
            section.items.forEach(item => {
              const itemDiv = document.createElement('div');
              itemDiv.className = 'menu-item';
              itemDiv.setAttribute('data-plat', item.plat);
              itemDiv.setAttribute('data-prix', item.prix);
              itemDiv.innerHTML = `
                <div class="item-info">
                  <div class="item-name">
                    <i class="fas fa-${item.icon || 'circle'}"></i>
                    ${item.plat}
                  </div>
                  <div class="item-desc">${item.description}</div>
                </div>
                <div class="item-price">${item.prix} درهم</div>
              `;
              categoryItems.appendChild(itemDiv);
            });
            
            categoryDiv.appendChild(categoryHeader);
            categoryDiv.appendChild(categoryItems);
            menuContainer.appendChild(categoryDiv);

            // إضافة مسافة بعد قسم الحلويات والمشروبات
            if (section.section.includes('الحلويات') || section.section.includes('المشروبات')) {
              const spacer = document.createElement('div');
              spacer.className = 'after-desserts';
              menuContainer.appendChild(spacer);
            }
          });
          
          // إعادة ربط أحداث النقر على العناصر
          attachMenuItemsEvents();
        } else {
          menuContainer.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text); opacity: 0.6;">لا توجد عناصر في القائمة حالياً</div>';
        }
      });
    }

    // دالة لربط أحداث النقر على عناصر القائمة
    function attachMenuItemsEvents() {
      document.querySelectorAll('.menu-item').forEach(item => {
        item.addEventListener('click', function() {
          const plat = this.getAttribute('data-plat');
          const prix = parseInt(this.getAttribute('data-prix'));
          
          // التحقق مما إذا كان الطبق موجوداً بالفعل
          const existingItem = commandes.find(c => c.plat === plat);
          
          if (existingItem) {
            existingItem.quantite += 1;
          } else {
            commandes.push({
              plat: plat,
              quantite: 1,
              prix: prix
            });
          }
          
          // تأثير مرئي عند الإضافة
          this.style.transform = 'scale(0.95)';
          setTimeout(() => {
            this.style.transform = 'scale(1)';
          }, 200);
          
          // تحديث العرض
          updateCartDisplay();
          
          // إظهار سلة التسوق العائمة
          showCartBar();
        });
      });
    }

    // عرض شريط السلة مع مؤقت للإخفاء
    function showCartBar() {
      cartFloating.classList.add('active');
      
      // إلغاء أي مؤقت سابق
      if (cartTimeout) {
        clearTimeout(cartTimeout);
      }
      
      // تعيين مؤقت جديد للإخفاء بعد 3 ثواني إذا كانت السلة فارغة
      if (commandes.length === 0) {
        cartTimeout = setTimeout(() => {
          cartFloating.classList.remove('active');
        }, 3000);
      }
    }

    // تحديث عرض السلة
    function updateCartDisplay() {
      // حساب العدد الإجمالي والمجموع
      let count = 0;
      total = 0;
      
      commandes.forEach(commande => {
        count += commande.quantite;
        total += commande.quantite * commande.prix;
      });
      
      // تحديث العناصر
      cartCount.textContent = count;
      cartTotal.textContent = total + ' درهم';
      
      // تحديث قائمة الطلبات في المودال
      const listeCommandes = document.getElementById('listeCommandes');
      listeCommandes.innerHTML = '';
      
      if (commandes.length === 0) {
        listeCommandes.innerHTML = `
          <div style="text-align: center; padding: 2rem 0; color: var(--text); opacity: 0.6;">
            <i class="fas fa-shopping-cart" style="font-size: 2rem; margin-bottom: 1rem;"></i>
            <p>لا توجد أصناف في السلة</p>
          </div>
        `;
      } else {
        commandes.forEach((commande, index) => {
          const sousTotal = commande.quantite * commande.prix;
          
          const orderItem = document.createElement('div');
          orderItem.className = 'order-item';
          orderItem.innerHTML = `
            <div>${commande.plat}</div>
            <div style="font-weight: 700;">${sousTotal} درهم</div>
            <div class="item-actions">
              <button class="action-btn remove" data-index="${index}">
                <i class="fas fa-trash"></i>
              </button>
              <button class="action-btn" data-index="${index}" data-action="decrease">
                <i class="fas fa-minus"></i>
              </button>
              <span style="margin: 0 0.5rem;">${commande.quantite}</span>
              <button class="action-btn" data-index="${index}" data-action="increase">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          `;
          listeCommandes.appendChild(orderItem);
        });
      }
      
      // تحديث المجموع الكلي في المودال
      document.getElementById('totalCommande').textContent = `المجموع: ${total} درهم`;
      
      // إضافة أحداث للأزرار في المودال
      document.querySelectorAll('.action-btn.remove').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.getAttribute('data-index'));
          commandes.splice(index, 1);
          updateCartDisplay();
        });
      });
      
      document.querySelectorAll('.action-btn:not(.remove)').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.getAttribute('data-index'));
          const action = this.getAttribute('data-action');
          
          if (action === 'increase') {
            commandes[index].quantite += 1;
          } else if (action === 'decrease' && commandes[index].quantite > 1) {
            commandes[index].quantite -= 1;
          } else if (action === 'decrease' && commandes[index].quantite === 1) {
            commandes.splice(index, 1);
          }
          
          updateCartDisplay();
        });
      });
    }

    // أحداث النقر على الأزرار
    viewCartBtn.addEventListener('click', function(e) {
      e.preventDefault();
      orderModal.classList.add('active');
    });
    
    closeModalBtn.addEventListener('click', function(e) {
      e.preventDefault();
      orderModal.classList.remove('active');
    });
    
    cartNavItem.addEventListener('click', function(e) {
      e.preventDefault();
      orderModal.classList.add('active');
    });
    
    closeConfirmationBtn.addEventListener('click', function() {
      confirmation.classList.remove('active');
    });

    // عند تحميل الصفحة
    document.addEventListener('DOMContentLoaded', function() {
      // عرض تاريخ اليوم بالأرقام الفرنسية
      displayTodayDate();
      
      // تحميل وعرض القائمة من Firebase
      loadAndDisplayMenu();
      
      // معالجة إرسال النموذج
      document.getElementById('commandeForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const table = document.getElementById('table').value;
        const notes = document.getElementById('notes').value;
        
        if (!table || commandes.length === 0) {
          alert('الرجاء تحديد رقم الطاولة وإضافة طلب واحد على الأقل');
          return;
        }
        
        // إرسال البيانات إلى Firebase
        database.ref('commandes').push({
          table: table,
          notes: notes,
          commandes: commandes,
          total: total,
          timestamp: firebase.database.ServerValue.TIMESTAMP,
          statut: 'في الانتظار'
        }).then(() => {
          // عرض رسالة التأكيد
          confirmationText.innerHTML = `
            <p>رقم الطاولة: <strong>${table}</strong></p>
            <p style="margin: 1rem 0;">المجموع: <strong>${total} درهم</strong></p>
            ${notes ? `<p>ملاحظات: ${notes}</p>` : ''}
          `;
          confirmation.classList.add('active');
          
          // إعادة تعيين النموذج
          commandes = [];
          updateCartDisplay();
          this.reset();
          orderModal.classList.remove('active');
          cartFloating.classList.remove('active');
        }).catch(error => {
          alert('حدث خطأ أثناء إرسال الطلب: ' + error.message);
        });
      });
    });
  </script>
</body>
</html>
